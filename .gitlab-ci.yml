image: "python:3.9"

before_script:
  - python --version
  - pip install -r requirements.txt

stages:
  - Static Analysis
  - Unit Tests
  - Documentation

flake8:
  stage: Static Analysis
  tags:
    - docker
  script:
    - flake8 .
  only:
    - merge_requests

yapf:
  stage: Static Analysis
  tags:
    - docker
  script:
    - if [ `yapf -r ./ -d | wc -l` -gt 0 ] ; then false ; else true ;fi
  only:
    - merge_requests

unittests:
  stage: Unit Tests
  tags:
    - docker
  script:
    - SDL_VIDEODRIVER="dummy" python -m unittest discover -s src -t .. -p "test_*.py"
  only:
    - merge_requests

test-pages:
  stage: Documentation
  tags:
    - docker
  script:
    - pip install -U sphinx sphinx-autoapi sphinx-rtd-theme
    - sphinx-build -d docs/build/doctrees docs/source docs/build/html
    - mv docs/build/html public/
  artifacts:
    expose_as: HTML Documentation
    paths:
      - public
  only:
    - merge_requests

pages:
  stage: Documentation
  tags:
    - docker
    - pages
  script:
    - pip install -U sphinx sphinx-autoapi sphinx-rtd-theme
    - sphinx-build -d docs/build/doctrees docs/source docs/build/html
    - mv docs/build/html public/
  artifacts:
    paths:
      - public
  only:
    - master
